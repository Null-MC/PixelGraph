name: Release
on: workflow_dispatch

jobs:
  publish_cli:
    name: Publish CLI
    runs-on: ubuntu-latest
    needs: [prepare_release]
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive
      - name: Publish CLI Binaries
        run: |
          cd PixelGraph.CLI
          dotnet publish -c Release -r win-x64 -o ../publish/win-cli-x64 -p:PublishSingleFile=true --self-contained false
          dotnet publish -c Release -r linux-x64 -o ../publish/linux-cli-x64 -p:PublishSingleFile=true --self-contained false
          dotnet publish -c Release -r osx-x64 -o ../publish/osx-cli-x64 -p:PublishSingleFile=true --self-contained false
      - name: Upload Windows-CLI-x64 Binary
        uses: actions/upload-artifact@v3
        with:
          name: PixelGraph-CLI-Windows-x64.exe
          path: publish/win-cli-x64/PixelGraph.exe
      - name: Upload Linux-CLI-x64 Binary
        uses: actions/upload-artifact@v3
        with:
          name: PixelGraph-CLI-Linux-x64
          path: publish/linux-cli-x64/PixelGraph
      - name: Upload OSX-CLI-x64 Binary
        uses: actions/upload-artifact@v3
        with:
          name: PixelGraph-CLI-OSX-x64
          path: publish/osx-cli-x64/PixelGraph

  publish_ui:
    name: Publish UI
    runs-on: windows-latest
    needs: [prepare_release]
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive
      - name: Publish Windows-UI-x64 Binary
        run: |
          dotnet build PixelGraph.Rendering -c Release
          dotnet publish PixelGraph.UI -c Release -r win-x64 -o publish/win-ui-x64 -p:PublishSingleFile=true --self-contained false
      - name: Upload Windows-UI-x64 Binary
        uses: actions/upload-artifact@v3
        with:
          name: PixelGraph-UI-Windows-x64.exe
          path: publish/win-ui-x64/PixelGraph.exe
